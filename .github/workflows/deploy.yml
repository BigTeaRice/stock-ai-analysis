name: Deploy Flask App to GitHub Pages

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install yfinance pandas numpy plotly scikit-learn
    
    - name: Generate static site
      run: |
        mkdir -p docs
        # 创建简单的静态页面
        cat > docs/index.html << 'EOF'
        <!DOCTYPE html>
        <html lang="zh-CN">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>AI股票分析系统</title>
            <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
            <style>
                body { padding: 20px; }
                .card { margin: 20px 0; }
            </style>
        </head>
        <body>
            <div class="container">
                <h1 class="text-center">AI股票分析系统</h1>
                <div class="alert alert-info">
                    <p>这是一个基于AI的港股和美股分析平台，使用ARIMA、LSTM和线性回归模型进行预测。</p>
                    <p>完整功能版本正在部署中...</p>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">功能特点</div>
                            <div class="card-body">
                                <ul>
                                    <li>多种AI模型预测</li>
                                    <li>技术指标分析（ATR、布林带等）</li>
                                    <li>实时股票数据</li>
                                    <li>交互式图表</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">支持的市场</div>
                            <div class="card-body">
                                <ul>
                                    <li>港股：腾讯、阿里、美团等</li>
                                    <li>美股：苹果、谷歌、微软等</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="text-center mt-4">
                    <a href="https://github.com/yourusername/stock-ai-analysis" class="btn btn-primary">
                        查看项目代码
                    </a>
                </div>
            </div>
        </body>
        </html>
        EOF
        
        # 创建 .nojekyll 文件
        touch docs/.nojekyll
    
    - name: Upload artifact
      uses: actions/upload-pages-artifact@v3
      with:
        path: docs/

  deploy:
    if: github.ref == 'refs/heads/main'
    needs: build
    permissions:
      pages: write
      id-token: write
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
